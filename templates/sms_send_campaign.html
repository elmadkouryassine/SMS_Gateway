{% extends "base.html" %}
{% block title %}Envoyer une Campagne{% endblock %}

{% block content %}
<div class="container">
  <h3 class="mb-4">Effectuer une campagne</h3>

  <!-- Import Section -->
  <form method="post" enctype="multipart/form-data" action="/sms/import_campaign" id="import-form" class="mb-5">
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="unit" class="form-label">Unité :</label>
        <input type="text" class="form-control" id="unit" name="unit" placeholder="Unité">
      </div>
      <div class="col-md-6">
        <label for="campaign_name" class="form-label">Nom de campagne :</label>
        <input type="text" class="form-control" id="campaign_name" name="campaign_name" placeholder="Nom de la campagne">
      </div>
    </div>
    <div class="mb-3">
      <input class="form-control" type="file" name="file" id="file">
    </div>
    <div class="d-flex gap-3 mb-3">
      <button type="submit" class="btn btn-primary">Importer</button>
      <span>Exemple : <a href="/static/exemple.txt" target="_blank">ici</a></span>
      <span>Perso : <a href="/static/personnalise.txt" target="_blank">ici</a></span>
    </div>
  </form>

  {% if imported %}
  <!-- Campaign Form -->
  <form method="post" action="/sms/validate_campaign" id="campaign-form">
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="lang" class="form-label">Langue</label>
        <select class="form-select" id="lang" name="lang">
          <option value="Latin">Latin</option>
          <option value="UCS2">UCS2</option>
        </select>
      </div>
      <div class="col-md-8">
        <label for="label" class="form-label">Label</label>
        <input type="text" class="form-control" id="label" name="label">
      </div>
    </div>

    <div class="mb-3">
      <label for="message" class="form-label">Message</label>
      <textarea class="form-control" id="message" name="message" rows="4"></textarea>
      <small id="charCount" class="form-text text-muted">0 caractère(s) / 0 message(s)</small>
      <div class="progress mb-2">
        <div id="msgProgress" class="progress-bar" role="progressbar" style="width:0%"></div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-6">
        <label for="test_number" class="form-label">Test unitaire</label>
        <div class="input-group">
          <input type="text" class="form-control" id="test_number" name="test_number" placeholder="Numéro GSM">
          <button class="btn btn-outline-secondary" type="submit" name="action" value="test">Envoyer le test</button>
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Planification</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="schedule_type" id="sched_immediate" value="immediate" checked>
          <label class="form-check-label" for="sched_immediate">Immédiate</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="schedule_type" id="sched_programmed" value="scheduled">
          <label class="form-check-label" for="sched_programmed">Programmé</label>
        </div>
        <div class="form-check form-check-inline schedule-field d-none">
          <input type="datetime-local" name="scheduled_at" class="form-control" id="scheduled_at">
        </div>
      </div>
    </div>

    <div class="d-flex gap-3">
      <button type="submit" class="btn btn-success" name="action" value="validate">Valider</button>
      <a href="/" class="btn btn-secondary">Annuler</a>
    </div>
  </form>
  {% endif %}
</div>
<script src="/static/sms_campaign.js"></script>
{% endblock %}
